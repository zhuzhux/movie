<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>
	<style type="text/css">
		.mui-control-content {
			background-color: white;
			min-height: 500px;
			height: auto;
		}
		
		.mui-table-view {
			min-height: 500px;
		}
		#content .lia p{font-size: .75rem;}

	</style>
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?5d66bd0c136a6998ab02a25bd4034a87";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h2 class="mui-title">影片搜索</h2>
		</header>
		<div class="mui-content" id="content">
			<div class="mui-input-row mui-search" style="height: 49px;padding: 0px 5px;margin-top: 5px;">
				<input type="search" id="searchInput" class="mui-input-clear" placeholder="输入影片关键字" style="">
			</div>
			
			<div class="mui-card" style="margin-top:-10px;">
				<div class="mui-card-content">
					<ul class="mui-table-view mui-grid-view">
					</ul>
				</div>
			</div>
			
		</div>

		<script src="js/mui.min.js"></script>
		<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			document.getElementById("searchInput").addEventListener("keypress", function(event) {
				if(event.keyCode == "13") {
					document.activeElement.blur(); //收起虚拟键盘
					toSearch($("#searchInput").val());//TODO 完成搜索事件
					event.preventDefault(); // 阻止默认事件---阻止页面刷新
				}
			});
//			toSearch('');
			var sHeight=window.screen.availHeight-44;
			$('ul.mui-table-view').css({"minHeight":sHeight+"px"});

			function toSearch(wd){
				mui.ajax("http://movie.wxjii.cn/php/movieSearch.php",{
					data:{
						type:1,
						wd:wd
					},
					async:false,
					dataType:'json',
					type:'post',
					timeout:1000,
					success:function(data){
						if(data.data.length!=0){
							var str = '';
							for(var i = 0;i<data.data.length;i++){
								str +='<li class="mui-table-view-cell mui-media mui-col-xs-4"><div class="lia" id="list_'+i+'" data-href="'+data.data[i].href+'"><img class="mui-media-object" src="'+data.data[i].imgSrc+'"><p class="mui-media-body">'+data.data[i].filmName+'</p><p class="mui-media-body">'+data.data[i].actor+'</p></div></li>';
								$('ul.mui-table-view').html(str);
							}		
						}else{
							mui.toast('好像没有该片源,试试别的吧');
						}
						imgWH();
					}
				});
			}
			
			var detailPage = null;
	        //添加列表项的点击事件
	        mui('.mui-table-view ').on('tap', 'div', function(e) {
	            var id = this.getAttribute('id');
	            var href = this.getAttribute('data-href');
	            var title = this.getElementsByTagName('p')[0].innerHTML;
	            //获得详情页面
	            if(!detailPage){
	                detailPage = plus.webview.getWebviewById('movie.html');
	            }
	            //触发详情页面的topicId事件
	            mui.fire(detailPage,'topicId',{
	            	id:id
	            });
	            //打开详情页面          
	            mui.openWindow({
	            	url: "movie.html",
	                id:'movie.html',
					show: {
						autoShow: false, //页面loaded事件发生后自动显示，默认为true
						aniShow: "slide-in-right", //页面显示动画，默认为”slide-in-right“；
						duration: 200, //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
						event: 'loaded', //页面显示时机，默认为titleUpdate事件时显示
						extras: {} //窗口动画是否使用图片加速	
					},
					waiting: {
						autoShow: true,
						title: '正在加载...', //等待对话框上显示的提示内容
					},
	                extras:{
	                  href:href,
	                  title:title
	                }
	            });
	        });
        
			function imgWH(){
				var a = $('.mui-table-view .mui-table-view-cell .mui-media-object').width();
				$('.mui-table-view .mui-table-view-cell .mui-media-object').css({'height':a*1.4});
			}
       
		</script>
		<script>
		var _mtac = {};
		(function() {
		    var mta = document.createElement("script");
		    mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";
		    mta.setAttribute("name", "MTAH5");
		    mta.setAttribute("sid", "500507164");
		    var s = document.getElementsByTagName("script")[0];
		    s.parentNode.insertBefore(mta, s);
		})();
		</script>
	</body>

</html>